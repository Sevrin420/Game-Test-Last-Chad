<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Last Chad Adventure - Survive the Robot Invasion</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background-color: #0a0a0a;
            color: #00ff00;
            margin: 0;
            padding: 20px;
            max-width: 800px;
            margin: auto;
            line-height: 1.5;
            font-size: 1.1em;
        }
        h1, h2 {
            color: #ff6600;
            text-align: center;
        }
        #stats {
            background: #111;
            padding: 15px;
            border: 2px solid #00ff00;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        button {
            background: #ff6600;
            color: #000;
            border: none;
            padding: 14px 28px;
            margin: 10px 6px;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
            font-size: 1.1em;
            border-radius: 6px;
            min-width: 220px;
        }
        button:hover {
            background: #ff8800;
        }
        button:disabled {
            background: #333;
            cursor: not-allowed;
        }
        .outcome {
            margin: 20px 0;
            padding: 15px;
            border-left: 5px solid #ff6600;
            background: #111;
            border-radius: 6px;
        }
        .success { border-left-color: #00ff00; }
        .failure { border-left-color: #ff0000; }
        .roll-result {
            font-size: 1.3em;
            font-weight: bold;
        }
        #game-over, #victory {
            text-align: center;
            font-size: 1.8em;
            padding: 30px;
        }
        #start-screen {
            text-align: center;
            margin: 60px 0;
        }
    </style>
</head>
<body>
    <h1>üî• LAST CHAD ADVENTURE üî•</h1>
    <p style="text-align: center;">The island is in ruins. Blue robot women with red glowing eyes are wiping out the men. You are the Last Chad. Survive. Gather. Fight.</p>
    
    <div id="stats">
        <h2>Your Chad Stats</h2>
        <div id="stat-display">Waiting to start...</div>
    </div>
    
    <div id="game-container">
        <div id="start-screen">
            <button onclick="startGame()" style="font-size:1.6em; padding:30px 60px;">
                START ADVENTURE<br>Enter Your Stats
            </button>
            <p style="margin-top:20px; color:#aaa; font-size:0.9em;">
                (Tap the button above to begin ‚Äì required on mobile)
            </p>
        </div>
    </div>

    <script>
        // Global game state
        let gameState = {
            stats: null,
            currentNode: 'start',
            rolls: [],
            resources: 0,
            knowledge: 0,
            robotsDefeated: 0
        };

        // Adventure nodes (same as before)
        const adventureNodes = {
            start: {
                text: `You awaken in the rubble of Hawaiian Paradise Park. Smoke rises from the small city nearby. You hear laser fire and screams. Your home is destroyed, but you're alive.

You scavenge your backpack: <strong>3 rations</strong> (resources +3).

What do you do?`,
                choices: [
                    { text: "Head to the city to fight robots", next: "city_fight" },
                    { text: "Search the jungle for survivors", next: "jungle_search" }
                ]
            },
            city_fight: {
                text: `You sneak into the city outskirts. A blue robot woman patrols, red eyes scanning. She spots you!

<strong>Encounter 1: Combat Roll (Strength)</strong><br>
Roll d20 + Strength vs DC 15. Beat it to smash her circuits!`,
                choices: [
                    { text: "Yes, charge in!", action: "roll_strength", nextSuccess: "city_win", nextFail: "city_fail" }
                ],
                rollType: "strength",
                dc: 15
            },
            city_win: {
                text: `<div class="outcome success">üí• You crush the robot's head with a pipe! You loot <strong>2 tech scraps</strong> (resources +2) and a <strong>laser pistol</strong>.</div>

A dying survivor gasps: "The robots fear... the volcano..."`,
                choices: [
                    { text: "Yes, head to the volcano?", next: "volcano_path" },
                    { text: "No, search the city ruins first", next: "city_ruins" }
                ]
            },
            city_fail: {
                text: `<div class="outcome failure">üòµ Your punch glances off her armor. She blasts you! You barely escape, wounded (-1 ration).</div>

Limping away, you spot a hidden bunker.`,
                choices: [
                    { text: "Yes, enter the bunker?", next: "bunker" },
                    { text: "No, flee to jungle", next: "jungle_search" }
                ]
            },
            jungle_search: {
                text: `In the dense jungle, you find a camp of 2 survivors ‚Äì fellow Chads!

<strong>Encounter 2: Stealth Roll (Dexterity)</strong><br>
Roll d20 + Dexterity vs DC 14 to sneak past a robot scout.`,
                choices: [
                    { text: "Yes, attempt stealth", action: "roll_dexterity", nextSuccess: "jungle_win", nextFail: "jungle_fail" }
                ],
                rollType: "dexterity",
                dc: 14
            },
            jungle_win: {
                text: `<div class="outcome success">üïµÔ∏è You slip by unseen. The survivors share <strong>knowledge of robot weakness: EMP pulses</strong> (knowledge +1).</div>`,
                choices: [
                    { text: "Yes, ask about city safe spot?", next: "safe_spot" },
                    { text: "No, press on to city", next: "city_ruins" }
                ]
            },
            jungle_fail: {
                text: `<div class="outcome failure">ü§¶ You snap a twig. Robot alarms! You fight it off but survivors flee.</div>`,
                choices: [
                    { text: "Continue to city", next: "city_ruins" }
                ]
            },
            city_ruins: {
                text: `City ruins: You find a generator guarded by 2 robots.

<strong>Encounter 3: Puzzle Roll (Intelligence)</strong><br>
Roll d20 + Intelligence vs DC 16 to hack an EMP blast.`,
                choices: [
                    { text: "Yes, try to hack it", action: "roll_intelligence", nextSuccess: "ruins_win", nextFail: "ruins_fail" }
                ],
                rollType: "intelligence",
                dc: 16
            },
            ruins_win: {
                text: `<div class="outcome success">üß† EMP blast! Robots fry. +5 scraps & EMP knowledge.</div>`,
                choices: [
                    { text: "Yes, barter scraps for info?", next: "barter" },
                    { text: "No, head to docks", next: "docks" }
                ]
            },
            ruins_fail: {
                text: `<div class="outcome failure">üíª No EMP. Robots attack ‚Äì you run, losing 1 ration.</div>`,
                choices: [
                    { text: "Flee to docks", next: "docks" }
                ]
            },
            safe_spot: {
                text: `Survivors reveal a hidden bar. You barter 1 ration for <strong>patrol routes</strong> (knowledge +1).`,
                choices: [
                    { text: "Yes, infiltrate the bar?", next: "barter" }
                ]
            },
            bunker: {
                text: `Bunker: Old Chad trader.

<strong>Encounter 4: Barter Roll (Charisma)</strong><br>
Roll d20 + Charisma vs DC 13 to get info.`,
                choices: [
                    { text: "Yes, persuade him", action: "roll_charisma", nextSuccess: "bunker_win", nextFail: "bunker_fail" }
                ],
                rollType: "charisma",
                dc: 13
            },
            bunker_win: {
                text: `<div class="outcome success">üòé He gives you a map: Queen at docks (knowledge +1).</div>`,
                choices: [
                    { text: "Yes, assault the docks?", next: "docks" }
                ]
            },
            bunker_fail: {
                text: `<div class="outcome failure">ü§® "No deal." Nothing gained.</div>`,
                choices: [
                    { text: "Leave for docks", next: "docks" }
                ]
            },
            barter: {
                text: `Shady Chads at bar: "Queen robot controls them from the docks."`,
                choices: [
                    { text: "Yes, rally for final assault?", next: "final_prep" }
                ]
            },
            volcano_path: {
                text: `Volcano trail: Robots massing. Intel says docks is the real target.`,
                choices: [
                    { text: "Yes, push to docks instead", next: "docks" }
                ]
            },
            docks: {
                text: `Docks: Burning ships. Queen Robot (huge, bright red eyes) commands the swarm.

<strong>Encounter 5: Final Battle</strong><br>
Roll d20 + (Strength + Dexterity)/2 vs DC 17. Knowledge helps!`,
                choices: [
                    { text: "Yes, final battle!", action: "roll_final", nextSuccess: "victory", nextFail: "game_over" }
                ],
                rollType: "final",
                dc: 17
            },
            final_prep: {
                text: `Rallied Chads join you. +2 bonus to final roll!`,
                choices: [
                    { text: "Charge!", next: "docks", bonus: 2 }
                ]
            },
            victory: {
                text: `<div id="victory" style="color:#00ff00;">
üèÜ VICTORY! üèÜ<br>
You destroy the Queen! Robots shut down. Island saved.<br><br>
Resources: <span id="final-resources"></span> | Defeated: <span id="final-defeated"></span> | Wins: <span id="rolls-won"></span>/5
</div>`,
                choices: []
            },
            game_over: {
                text: `<div id="game-over" style="color:#ff0000;">
üíÄ GAME OVER üíÄ<br>
The Queen vaporizes you.<br><br>
Resources: <span id="final-resources"></span> | Defeated: <span id="final-defeated"></span> | Wins: <span id="rolls-won"></span>/5<br>
<strong>Mint another Chad and try again!</strong>
</div>`,
                choices: []
            }
        };

        function rollD20() {
            return Math.floor(Math.random() * 20) + 1;
        }

        function displayNode() {
            const node = adventureNodes[gameState.currentNode];
            const container = document.getElementById('game-container');
            let html = `<div style="background:#111; padding:20px; border:2px solid #ff6600; border-radius:8px; margin-bottom:20px;">
                <p>${node.text}</p>`;

            if (node.choices.length === 0) {
                setTimeout(() => {
                    const resEl = document.getElementById('final-resources');
                    const defEl = document.getElementById('final-defeated');
                    const wonEl = document.getElementById('rolls-won');
                    if (resEl) resEl.textContent = gameState.resources;
                    if (defEl) defEl.textContent = gameState.robotsDefeated;
                    if (wonEl) wonEl.textContent = gameState.rolls.filter(r => r.success).length;
                }, 100);
                container.innerHTML = html + '</div>';
                return;
            }

            html += '<div style="text-align:center;">';
            node.choices.forEach(choice => {
                html += `<button onclick="makeChoice('\( {choice.next || ''}', ' \){choice.action || ''}', '${choice.rollType || ''}', \( {choice.bonus || 0})"> \){choice.text}</button><br>`;
            });
            html += '</div></div>';

            container.innerHTML = html;
        }

        function makeChoice(next, action, rollType, bonus = 0) {
            if (action.startsWith('roll_')) {
                const isFinal = rollType === 'final';
                const mod = isFinal 
                    ? Math.floor((gameState.stats.strength + gameState.stats.dexterity) / 2)
                    : gameState.stats[rollType];
                
                let totalBonus = mod + (bonus || 0) + gameState.knowledge;
                const roll = rollD20();
                const total = roll + totalBonus;
                const dc = adventureNodes[gameState.currentNode].dc;
                const success = total >= dc;

                gameState.rolls.push({ roll, mod, total, success, dc });

                let outcomeClass = success ? 'success' : 'failure';
                let outcomeText = success ? 'SUCCESS!' : 'FAILURE!';
                if (success) {
                    gameState.resources += 2;
                    gameState.robotsDefeated += 1;
                } else {
                    gameState.resources = Math.max(0, gameState.resources - 1);
                }

                const rollHtml = `<div class="outcome ${outcomeClass}">
                    <span class="roll-result">üé≤ ${roll} + ${totalBonus} = ${total} vs ${dc} ‚Üí ${outcomeText}</span><br>
                    <strong>\( {rollType.toUpperCase()} ( \){mod})</strong>
                </div>`;

                document.getElementById('game-container').innerHTML += rollHtml;

                setTimeout(() => {
                    gameState.currentNode = success 
                        ? (adventureNodes[gameState.currentNode].nextSuccess || next)
                        : (adventureNodes[gameState.currentNode].nextFail || next);
                    displayNode();
                    updateStats();
                }, 1800);
            } else {
                if (next) gameState.currentNode = next;
                displayNode();
                updateStats();
            }
        }

        function updateStats() {
            const display = document.getElementById('stat-display');
            if (!gameState.stats) return;
            display.innerHTML = `
                Strength: ${gameState.stats.strength} | Intelligence: ${gameState.stats.intelligence}<br>
                Dexterity: ${gameState.stats.dexterity} | Charisma: ${gameState.stats.charisma}<br>
                <strong>Resources: ${gameState.resources} | Knowledge: ${gameState.knowledge} | Robots Defeated: ${gameState.robotsDefeated}</strong>
            `;
        }

        function startGame() {
            document.getElementById('start-screen').style.display = 'none';
            initGame();
        }

        function initGame() {
            // Try to ask for stats
            let s = prompt("Enter Strength (0-10):") || "3";
            let i = prompt("Enter Intelligence (0-10):") || "2";
            let d = prompt("Enter Dexterity (0-10):") || "3";
            let c = prompt("Enter Charisma (0-10):") || "2";

            gameState.stats = {
                strength: parseInt(s) || 3,
                intelligence: parseInt(i) || 2,
                dexterity: parseInt(d) || 3,
                charisma: parseInt(c) || 2,
                avg_sd: 0 // will be set below
            };
            gameState.stats.avg_sd = Math.floor((gameState.stats.strength + gameState.stats.dexterity) / 2);
            gameState.resources = 3;

            updateStats();
            displayNode();
        }

        // Fallback: if no interaction after 8 seconds, use defaults (mobile safety)
        setTimeout(() => {
            if (!gameState.stats) {
                gameState.stats = {
                    strength: 5, intelligence: 4, dexterity: 5, charisma: 4,
                    avg_sd: Math.floor((5 + 5)/2)
                };
                gameState.resources = 3;
                updateStats();
                displayNode();
                alert("Mobile prompt blocked? Using default balanced Chad stats.");
            }
        }, 8000);
    </script>
</body>
</html>
